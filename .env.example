# =================================================================
# Cumments Configuration Template (v0.10.0+ Structured)
# =================================================================
# Instructions:
# 1. Copy this file to `.env`.
# 2. Modify values. Note the double underscores (__) for nesting.
# 3. Choose ONE mode: "bot" or "appservice".
# =================================================================

# -----------------------------------------------------------------
# 1. Server Settings
# -----------------------------------------------------------------

# API Server binding (The HTTP API for your blog frontend)
# Corresponds to: server.host, server.port
CUMMENTS_SERVER__HOST=0.0.0.0
CUMMENTS_SERVER__PORT=3000
# [Optional] CORS Allowed Origins (Comma separated)
# Example: https://myblog.com,http://localhost:8080
# Default: * (Allow All)
CUMMENTS_SERVER__CORS_ORIGINS=*

# -----------------------------------------------------------------
# 2. Database Settings
# -----------------------------------------------------------------

# SQLite Database URL
# Corresponds to: database.url
# Recommended: keep data/ prefix for Docker volume mapping.
CUMMENTS_DATABASE__URL=sqlite://data/cumments.db

# [Dev Only] Helper for SQLx CLI (cargo sqlx prepare / sqlx migrate)
# SQLx macros do not read the CUMMENTS_ prefix at compile time.
# Keep this line strictly for development tools.
DATABASE_URL=sqlite://data/cumments.db

# -----------------------------------------------------------------
# 3. Security Settings (Required)
# -----------------------------------------------------------------

# Salt used for hashing user emails/tokens to generate consistent
# Ghost IDs (AS Mode) or Identity Fingerprints (Bot Mode).
# CRITICAL: CHANGE THIS to a long random string in production!
CUMMENTS_SECURITY__IDENTITY_SALT=change_me_please

# -----------------------------------------------------------------
# 4. Mode Selection
# -----------------------------------------------------------------

# Operating Mode:
# - bot: Standard client mode. Easy to setup. Uses a single bot account.
# - appservice: AppService mode. Requires homeserver config. Supports Ghost Users.
# Corresponds to: matrix.mode
CUMMENTS_MATRIX__MODE=bot

# -----------------------------------------------------------------
# 5. Option A: BOT Mode Configuration (Default)
# -----------------------------------------------------------------
# Use this if you just want to run a bot on matrix.org or any server.
# Only required if CUMMENTS_MATRIX__MODE=bot

# Your Matrix homeserver URL (Client-Server API)
CUMMENTS_MATRIX__HOMESERVER_URL=https://matrix.org

# The Bot's full user ID
CUMMENTS_MATRIX__USER=@cumments_bot:matrix.org

# Access Token for the Bot
# Get this from Element Web -> Settings -> Help & About -> Advanced -> Access Token
CUMMENTS_MATRIX__TOKEN=syt_YourBotToken_...

# -----------------------------------------------------------------
# 6. Option B: AppService Mode Configuration (Advanced)
# -----------------------------------------------------------------
# Use this ONLY if you run your own Synapse/Dendrite server and have
# configured a registration.yaml.
# Only required if CUMMENTS_MATRIX__MODE=appservice

# The Homeserver URL (Local listener usually preferred for AS)
# e.g., http://localhost:8008 or http://synapse:8008 (Docker)
# CUMMENTS_MATRIX__HOMESERVER_URL=http://localhost:8008

# Your Matrix Domain Name (e.g., curious.host, matrix.org)
# Used to construct Ghost User IDs (e.g., @cumments_alice:curious.host)
# CUMMENTS_MATRIX__SERVER_NAME=example.com

# Token defined in your registration.yaml (as_token)
# Used by Cumments to impersonate users.
# CUMMENTS_MATRIX__AS_TOKEN=YourSecretASToken

# Token defined in your registration.yaml (hs_token)
# Used to verify requests coming FROM the homeserver.
# CUMMENTS_MATRIX__HS_TOKEN=YourSecretHSToken

# The localpart of the main bot user (defined in registration.yaml sender_localpart)
# Default: cumments_bot
# CUMMENTS_MATRIX__BOT_LOCALPART=cumments_bot

# Port to listen for Matrix Transactions (Push)
# MUST match the 'url' field in your registration.yaml
# Note: This is DIFFERENT from the CUMMENTS_SERVER__PORT (API port)
# CUMMENTS_MATRIX__LISTEN_PORT=3001

# -----------------------------------------------------------------
# 7. Logging Configuration
# -----------------------------------------------------------------
# Adjust verbosity: error, warn, info, debug, trace
RUST_LOG=server=info,adapter=info,storage=info,matrix_sdk=error

# -----------------------------------------------------------------
# Reference: Minimal registration.yaml for Synapse
# -----------------------------------------------------------------
# id: cumments_bridge
# url: "http://localhost:3001"  <-- Must match CUMMENTS_MATRIX__LISTEN_PORT
# as_token: "YourSecretASToken" <-- Must match CUMMENTS_MATRIX__AS_TOKEN
# hs_token: "YourSecretHSToken" <-- Must match CUMMENTS_MATRIX__HS_TOKEN
# sender_localpart: "cumments_bot" <-- Must match CUMMENTS_MATRIX__BOT_LOCALPART
# namespaces:
#   users:
#     - exclusive: true
#       regex: "@cumments_.*"
#   aliases:
#     - exclusive: true
#       regex: "#cumments_.*"
#   rooms: []
